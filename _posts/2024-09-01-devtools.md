---
layout:     post
tags:       blog
title:      "DevTools TODO"
date:       2024-09-01
summary:    "TODO"
categories:
---

TODO: LINKS

Since June Servo has been working on improving the [Firefox devtools](CITATION) support as part of the [Outreachy](CITATION) internship program.

Devtools are a set of web developer tools inside Firefox that allow to examine, edit and debug HTML, CSS and JavaScript. Servo takes advantage of the existing work there and uses the open protocol to allow inspecting its own websites.

IMAGE

While relying on a third party API allows us to offer this functionality without coding it from scratch, it doesn't come without downsides. Back in June of last year, with the release of Firefox 110, the breaking changes of the protocol made our previous implementation stop working. The main issue was that the messages that Servo and Firefox sent to eachother to make the devtools work had a different structure, so we needed to change our code to match.

We first updated an existing patch that fixed the connection and got the different web views that Servo is running listed (@fabricedesre, @eerii, @mrobinson, #32475). Then we had to update how some [actors](https://firefox-source-docs.mozilla.org/devtools/backend/actor-hierarchy.html) were structured, since it changed quite a bit (@eerii, #32509). An actor is a piece of code that can respond to messages sent by Firefox with relevant information.

One of the main challenges was figuring out what were the messages that we needed to send back to Firefox. The [source code](CITATION) for their devtools implementation is very well commented and proved to be invaluable. However, it can be very useful to see what the actual messages being sent are. While Servo can show the ones it is sending and receiving, we found out it is very useful to debug another instance of Firefox and see what messages it dispatches. We made a helper script (@eerii, #32684) using [Wireshark](CITATION) to inspect the connection between the devtools client and server, which allows to view the contents of each packet and search through them.

Support for the console was fixed, which allows to run JavaScript code directly on Servo's webviews and see any warning that the page emits (@eerii, @mrobinson, #32727).

IMAGE

Finally, the biggest changes were in how the DOM inspector worked. Here we needed to more tightly integrate with Servo's script module to retrieve the properties of each element. Viewing CSS styles was particularly tricky, since they can come from many places (the `style` attribute, a stylesheet, an ancestor, ...), but @emilio had great insight into where to look. However, now it is possible to view the HTML tree of what is being rendered and add, remove or modify any attribute or CSS property (@eerii, @mrobinson, #32655, #32884, #32888, #33025).

This changes have already landed. For a step by step guide on how to use the devtools inspector, check the [Servo book](https://book.servo.org/hacking/using-devtools.html). We are looking for any feedback on how they work and what other not yet supported features match your use case.

There is still work to be done. Right now only the console and inspector are supported, but other useful features like the network analyzer or the storage tab are still not functional. Moreover, some pieces of the DOM inspector are still barebones. Now that flexbox is enabled by default (@mrobinson, #33186) it would be a good idea to support it in the layout panel. We are working on developer documentation that will be available on the book to make future contributions easier.

We would like to thank Outreachy for offering this internship.
